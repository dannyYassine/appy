var cov_beqaj7yox=function(){var path='/Users/dannyyassine/Documents/dev/node_shell/src/api/v1/services/performScript.js',hash='16fa679b3d51c3f8274123d105254bb92b041549',global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/dannyyassine/Documents/dev/node_shell/src/api/v1/services/performScript.js',statementMap:{'0':{start:{line:4,column:11},end:{line:4,column:24}},'1':{start:{line:5,column:26},end:{line:5,column:56}},'2':{start:{line:6,column:27},end:{line:6,column:70}},'3':{start:{line:7,column:14},end:{line:7,column:44}},'4':{start:{line:9,column:22},end:{line:84,column:4}},'5':{start:{line:17,column:33},end:{line:20,column:5}},'6':{start:{line:18,column:8},end:{line:18,column:47}},'7':{start:{line:19,column:8},end:{line:19,column:55}},'8':{start:{line:26,column:26},end:{line:80,column:5}},'9':{start:{line:30,column:26},end:{line:30,column:64}},'10':{start:{line:31,column:25},end:{line:31,column:61}},'11':{start:{line:32,column:25},end:{line:32,column:51}},'12':{start:{line:33,column:21},end:{line:33,column:49}},'13':{start:{line:34,column:29},end:{line:34,column:65}},'14':{start:{line:37,column:29},end:{line:41,column:10}},'15':{start:{line:38,column:12},end:{line:40,column:15}},'16':{start:{line:39,column:16},end:{line:39,column:32}},'17':{start:{line:43,column:40},end:{line:47,column:10}},'18':{start:{line:44,column:12},end:{line:46,column:15}},'19':{start:{line:45,column:16},end:{line:45,column:32}},'20':{start:{line:49,column:32},end:{line:53,column:10}},'21':{start:{line:50,column:12},end:{line:52,column:15}},'22':{start:{line:51,column:16},end:{line:51,column:33}},'23':{start:{line:56,column:8},end:{line:78,column:11}},'24':{start:{line:58,column:26},end:{line:60,column:14}},'25':{start:{line:62,column:12},end:{line:62,column:39}},'26':{start:{line:63,column:12},end:{line:63,column:54}},'27':{start:{line:65,column:12},end:{line:67,column:15}},'28':{start:{line:66,column:16},end:{line:66,column:67}},'29':{start:{line:69,column:12},end:{line:71,column:15}},'30':{start:{line:70,column:16},end:{line:70,column:67}},'31':{start:{line:73,column:12},end:{line:77,column:15}},'32':{start:{line:74,column:16},end:{line:74,column:67}},'33':{start:{line:75,column:16},end:{line:75,column:34}},'34':{start:{line:76,column:16},end:{line:76,column:57}},'35':{start:{line:81,column:4},end:{line:83,column:5}},'36':{start:{line:86,column:0},end:{line:86,column:31}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:9,column:23},end:{line:9,column:24}},loc:{start:{line:9,column:35},end:{line:84,column:1}},line:9},'1':{name:'(anonymous_1)',decl:{start:{line:17,column:33},end:{line:17,column:34}},loc:{start:{line:17,column:67},end:{line:20,column:5}},line:17},'2':{name:'(anonymous_2)',decl:{start:{line:26,column:26},end:{line:26,column:27}},loc:{start:{line:26,column:44},end:{line:80,column:5}},line:26},'3':{name:'(anonymous_3)',decl:{start:{line:37,column:41},end:{line:37,column:42}},loc:{start:{line:37,column:62},end:{line:41,column:9}},line:37},'4':{name:'(anonymous_4)',decl:{start:{line:38,column:37},end:{line:38,column:38}},loc:{start:{line:38,column:54},end:{line:40,column:13}},line:38},'5':{name:'(anonymous_5)',decl:{start:{line:43,column:52},end:{line:43,column:53}},loc:{start:{line:43,column:73},end:{line:47,column:9}},line:43},'6':{name:'(anonymous_6)',decl:{start:{line:44,column:45},end:{line:44,column:46}},loc:{start:{line:44,column:62},end:{line:46,column:13}},line:44},'7':{name:'(anonymous_7)',decl:{start:{line:49,column:44},end:{line:49,column:45}},loc:{start:{line:49,column:65},end:{line:53,column:9}},line:49},'8':{name:'(anonymous_8)',decl:{start:{line:50,column:49},end:{line:50,column:50}},loc:{start:{line:50,column:55},end:{line:52,column:13}},line:50},'9':{name:'(anonymous_9)',decl:{start:{line:56,column:83},end:{line:56,column:84}},loc:{start:{line:56,column:89},end:{line:78,column:9}},line:56},'10':{name:'(anonymous_10)',decl:{start:{line:65,column:36},end:{line:65,column:37}},loc:{start:{line:65,column:52},end:{line:67,column:13}},line:65},'11':{name:'(anonymous_11)',decl:{start:{line:69,column:36},end:{line:69,column:37}},loc:{start:{line:69,column:52},end:{line:71,column:13}},line:69},'12':{name:'(anonymous_12)',decl:{start:{line:73,column:29},end:{line:73,column:30}},loc:{start:{line:73,column:45},end:{line:77,column:13}},line:73}},branchMap:{},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0},b:{},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();/**
 * Created by dannyyassine on 2017-06-23.
 */const fs=(++cov_beqaj7yox.s[0],require('fs'));const projectFileSystem=(++cov_beqaj7yox.s[1],require('./projectFileSystem'));const projectDataManager=(++cov_beqaj7yox.s[2],require('../dataSource/ProjectDataManager'));const spawn=(++cov_beqaj7yox.s[3],require('child_process').spawn);const scriptManager=(++cov_beqaj7yox.s[4],function(){++cov_beqaj7yox.f[0];++cov_beqaj7yox.s[5];/**
     *
     * @param runLog
     * @param progressiveLog
     * @param data
     */const appendDataToFileLogs=(runLog,progressiveLog,data)=>{++cov_beqaj7yox.f[1];++cov_beqaj7yox.s[6];fs.appendFile(runLog,data.toString());++cov_beqaj7yox.s[7];fs.appendFile(progressiveLog,data.toString());};/**
     *
     * @param project
     */++cov_beqaj7yox.s[8];const performScript=function(project){++cov_beqaj7yox.f[2];// Set up all local variables
//FIXME: these variables could be injectable
let projectPath=(++cov_beqaj7yox.s[9],projectFileSystem.projectPath(project));let scriptText=(++cov_beqaj7yox.s[10],JSON.parse(project.shellTask.script));let scriptFile=(++cov_beqaj7yox.s[11],`${projectPath}/script.sh`);let runLog=(++cov_beqaj7yox.s[12],`${projectPath}/run-log.txt`);let progressiveLog=(++cov_beqaj7yox.s[13],`${projectPath}/progressive-log.txt`);// Promises
const resetFileLog=(++cov_beqaj7yox.s[14],new Promise((resolve,reject)=>{++cov_beqaj7yox.f[3];++cov_beqaj7yox.s[15];fs.writeFile(runLog,'',function(error){++cov_beqaj7yox.f[4];++cov_beqaj7yox.s[16];return resolve();});}));const resetProgressiveFileLog=(++cov_beqaj7yox.s[17],new Promise((resolve,reject)=>{++cov_beqaj7yox.f[5];++cov_beqaj7yox.s[18];fs.writeFile(progressiveLog,'',function(error){++cov_beqaj7yox.f[6];++cov_beqaj7yox.s[19];return resolve();});}));const writeScriptFile=(++cov_beqaj7yox.s[20],new Promise((resolve,reject)=>{++cov_beqaj7yox.f[7];++cov_beqaj7yox.s[21];fs.writeFile(scriptFile,scriptText,()=>{++cov_beqaj7yox.f[8];++cov_beqaj7yox.s[22];return resolve();});}));// Execute Promises before running script
++cov_beqaj7yox.s[23];Promise.all([resetFileLog,resetProgressiveFileLog,writeScriptFile]).then(()=>{++cov_beqaj7yox.f[9];const child=(++cov_beqaj7yox.s[24],spawn('sh',[scriptFile],{cwd:projectPath}));++cov_beqaj7yox.s[25];project.started(child.pid);++cov_beqaj7yox.s[26];projectDataManager.updateProject(project);++cov_beqaj7yox.s[27];child.stdout.on('data',function(data){++cov_beqaj7yox.f[10];++cov_beqaj7yox.s[28];appendDataToFileLogs(runLog,progressiveLog,data);});++cov_beqaj7yox.s[29];child.stderr.on('data',function(data){++cov_beqaj7yox.f[11];++cov_beqaj7yox.s[30];appendDataToFileLogs(runLog,progressiveLog,data);});++cov_beqaj7yox.s[31];child.on('exit',function(data){++cov_beqaj7yox.f[12];++cov_beqaj7yox.s[32];appendDataToFileLogs(runLog,progressiveLog,data);++cov_beqaj7yox.s[33];project.stopped();++cov_beqaj7yox.s[34];projectDataManager.updateProject(project);});});};++cov_beqaj7yox.s[35];return{performScript};}());++cov_beqaj7yox.s[36];module.exports=scriptManager;